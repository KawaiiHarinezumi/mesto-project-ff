(()=>{"use strict";var e="cf791a1a-25ef-4fca-8258-53a9d49cba1e",t="wff-cohort-7",n="https://nomoreparties.co/v1";function o(e){return e.ok?e.json():e.json().then((function(t){return t.httpResponseCode=e.status,Promise.reject(t)}))}document.querySelector(".profile__image"),document.querySelector(".profile__title"),document.querySelector(".profile__description");var c=document.querySelector("#card-template").content,r=document.querySelector(".places__list");function i(e,t,n,o){var i=function(e,t,n,o,r){var i=c.querySelector(".places__item").cloneNode(!0),a=i.querySelector(".card__image"),u=i.querySelector(".card__title"),l=i.querySelector(".card__delete-button"),s=i.querySelector(".card__like-button"),p=i.querySelector(".card__like-counter");return a.src=e.link,a.alt=e.name,u.textContent=e.name,p.textContent=e.likes.length,r===e.owner._id?l.addEventListener("click",t.bind(e._id)):l.remove(),e.likes.some((function(e){return e._id===r}))&&s.classList.add("card__like-button_is-active"),a.addEventListener("click",o),s.addEventListener("click",n.bind([e._id,p])),i}(e,t,a,n,o);r.prepend(i)}function a(c){var r,i=this,a=c.target;a.classList.contains("card__like-button_is-active")?(r=this[0],fetch("".concat(n,"/").concat(t,"/cards/likes/").concat(r),{method:"DELETE",headers:{authorization:e}}).then(o)).then((function(e){a.classList.toggle("card__like-button_is-active"),i[1].textContent=e.likes.length})).catch((function(e){console.log(e)})):function(c){return fetch("".concat(n,"/").concat(t,"/cards/likes/").concat(c),{method:"PUT",headers:{authorization:e}}).then(o)}(this[0]).then((function(e){a.classList.toggle("card__like-button_is-active"),i[1].textContent=e.likes.length})).catch((function(e){console.log(e)}))}function u(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",d),document.addEventListener("click",p),e.querySelector(".popup__close").addEventListener("click",s)}function l(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",d),document.removeEventListener("click",p),e.querySelector(".popup__close").removeEventListener("click",s)}function s(e){l(e.target.closest(".popup"))}function p(e){e.target.classList.contains("popup")&&l(e.target)}function d(e){"Escape"===e.key&&l(document.querySelector(".popup_is-opened"))}var _=document.querySelector(".popup__form"),f=_.querySelector(".popup__input"),m=_.querySelector(".".concat(f.id,"-error"));function y(e,t){e.classList.remove(t.inputErrorClass),m.classList.remove(t.errorClass),m.textContent=""}function v(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))}function h(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(e){y(e,t)})),v(n,o,t)}var S,q=document.querySelector(".profile__edit-button"),b=document.querySelector(".popup_type_edit"),g=document.querySelector(".profile__add-button"),C=document.querySelector(".popup_type_new-card"),k=document.querySelector(".popup_type_delete-card"),L=document.querySelector(".popup_type_image"),E=L.querySelector(".popup__image"),x=L.querySelector(".popup__caption"),T=document.querySelector(".popup_type_edit-avatar"),z=T.querySelector(".popup__input_type_url"),A=T.querySelector('[name="edit-avatar"]'),j=document.querySelector('[name="edit-profile"]'),w=j.querySelector(".popup__input_type_name"),B=j.querySelector(".popup__input_type_description"),D=document.querySelector(".profile__title"),P=document.querySelector(".profile__description"),N=document.querySelector(".profile__image"),O=document.querySelector('[name="new-place"]'),J=O.querySelector(".popup__input_type_card-name"),H=O.querySelector(".popup__input_type_url"),M=document.querySelector('[name="delete-card"]'),V={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error"},R="",U="",F="";function G(e){E.src=e.target.src,E.alt=e.target.alt,x.textContent=e.target.alt,u(L)}function I(e){var t=e.target;F=t.closest(".places__item"),U=this,u(k)}function K(e,t){t.textContent=e?"".concat(t.textContent,"..."):t.textContent.substring(0,t.textContent.length-3)}q.addEventListener("click",(function(e){w.value=D.textContent,B.value=P.textContent,h(j,V),u(b)})),g.addEventListener("click",(function(e){J.value="",H.value="",h(O,V),u(C)})),N.addEventListener("click",(function(e){z.value="",h(A,V),u(T)})),j.addEventListener("submit",(function(c){var r;K(!0,c.submitter),c.preventDefault(),(r={name:w.value,desc:B.value},fetch("".concat(n,"/").concat(t,"/users/me"),{method:"PATCH",headers:{authorization:e,"Content-Type":"application/json"},body:JSON.stringify({name:r.name,about:r.desc})}).then(o)).then((function(e){D.textContent=e.name,P.textContent=e.about})).catch((function(e){console.log(e)})).finally((function(e){l(b),K(!1,c.submitter)}))})),O.addEventListener("submit",(function(c){var r;K(!0,c.submitter),c.preventDefault(),(r={name:J.value,link:H.value},fetch("".concat(n,"/").concat(t,"/cards"),{method:"POST",headers:{authorization:e,"Content-Type":"application/json"},body:JSON.stringify({name:r.name,link:r.link})}).then(o)).then((function(e){i(e,I,G,R)})).catch((function(e){console.log(e)})).finally((function(e){l(C),K(!1,c.submitter)}))})),M.addEventListener("submit",(function(c){var r;c.preventDefault(),(r=U,fetch("".concat(n,"/").concat(t,"/cards/").concat(r),{method:"DELETE",headers:{authorization:e}}).then(o)).then((function(e){F.remove(),U=""})).catch((function(e){console.log(e)})).finally((function(e){l(k)}))})),A.addEventListener("submit",(function(c){var r;K(!0,c.submitter),c.preventDefault(),(r=z.value,fetch("".concat(n,"/").concat(t,"/users/me/avatar"),{method:"PATCH",headers:{authorization:e,"Content-Type":"application/json"},body:JSON.stringify({avatar:r})}).then(o)).then((function(e){N.style="background-image: url('".concat(e.avatar,"')")})).catch((function(e){console.log(e)})).finally((function(e){l(T),K(!1,c.submitter)}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(e){e.addEventListener("input",(function(){(function(e,t){e.validity.patternMismatch?e.setCustomValidity(" Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы."):e.setCustomValidity(""),e.validity.valid?y(e,t):function(e,t,n){e.classList.add(n.inputErrorClass),m.textContent=t,m.classList.add(n.errorClass)}(e,e.validationMessage,t)})(e,t),v(n,o,t)}))}))}(t,e)}))}(V),S=[fetch("".concat(n,"/").concat(t,"/users/me"),{headers:{authorization:e}}).then(o),fetch("".concat(n,"/").concat(t,"/cards"),{headers:{authorization:e}}).then(o)],Promise.all(S).then((function(e){D.textContent=e[0].name,P.textContent=e[0].about,N.style="background-image: url('".concat(e[0].avatar,"')"),R=e[0]._id,e[1].reverse().forEach((function(e){i(e,I,G,R)}))})).catch((function(e){console.log(e)}))})();